<!DOCTYPE html>
<html class="no-js">

<head>
	<meta charset="utf-8">
	<meta https-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Map</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/map.css">

	<!--[if lte IE 9]>
		<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
		<![endif]-->

		<!--[if IE]>
		<script type="text/javascript">
			window.onload = alert("I see you are using Internet Explorer. For the best experience, please use a different browser such as Edge, Firefox, or Chrome");
		</script>
			<![endif]-->

	<script src="js/vendor/modernizr.custom.32229-2.8-respondjs-1-4-2.js"></script>

	<style media="screen">
		#image{
			fill: url(gs://travel-map-dev.appspot.com/sj5MCetdkxPkcBuRx7sOyNuMWes2/TX/cropped_state_image.png);
		}
	</style>

</head>

<body class="body">
	<!--<header class="hero-image" role="banner" style="background-image: url(img/waterfall.jpg);">-->
	<!-- <header class="hero-image-about"> -->
	<header>
		<span class="menu-trigger animated fadeInDown">
		<span class="bar"></span>
		<span class="bar"></span>
		<span class="bar"></span>
		</span>

		<!-- if the user has javascript disabled they can still use the menu -->
		<noscript>
					<div class="no-js-menu">
						<ul>
							<li><i class="fa fa-home"></i><a href="index.html">Home</a></li>
							<!--[if IE]>
							<li id="LogInLink"><i class="fa fa-users"></i><a href="#" onclick="logginModal()">Log In</a></li>
							<li id="logOutLink"><i class="fa fa-users"></i><a href="map.html" onclick="signOutUser()">Log Out</a></li>
							<![endif]-->
							<!--[if !IE]><!-->
							<li><i class="fa fa-paper-plane"></i><a href="contact.html">Contact</a></li>
							<li><i class="fa fa-credit-card"></i><a href="checkout.html">Checkout</a></li>
						</ul>
					</div>
				</noscript>
		<!-- end no script -->

		<div id="menu-target">
			<ul>
				<li><i class="fa fa-home"></i><a href="index.html">Home</a></li>
				<!--[if IE]>
				<li id="LogInLink"><i class="fa fa-users"></i><a href="#" onclick="logginModal()">Log In</a></li>
				<li id="logOutLink"><i class="fa fa-users"></i><a href="map.html" onclick="signOutUser()">Log Out</a></li>
				<![endif]-->
				<!--[if !IE]><!-->
				<li><i class="fa fa-paper-plane"></i><a href="contact.html">Contact</a></li>
				<li><i class="fa fa-credit-card"></i><a href="checkout.html">Checkout</a></li>
			</ul>
			<hr>
		</div>
	</header>

	<div id="loginModal" class="logginModalClass">
		<div class="logginModal-content">

			<div class="logginModal-header">
				<span class="close">&times;</span>
			</div>
			<div id="signInModalContent" class="logginModal-body hide">
				<p style="padding-top:85px; padding-left:50px;">You Have Logged In successfully!</p>
			</div>
			<div id="modalBody" class="logginModal-body">
				<h2>Log In</h2>
				<form>
					<input type="text" placeholder="Email" id="email" name="email"/>
					<input type="password" placeholder="Password" id="password" name="password"/>
				</form>
				<input type="button" onclick="signInUser()" id="signIn" name="signIn" value="Log in"/>
				<p id="errorMsg" class="errorMsg"></p>
				<!-- <a id="changePasswordLink" class="hide" href="/changepassword.html">Change Your Password</a> -->
				<a id="changePasswordLink" href="/changepassword.html">Forgot Password?</a>
			</div>
			<div id="modalFooter" class="logginModal-footer">
				<p style="margin-bottom:10px">First Time? Create an account.</p>
				<input type="button" onclick="createUser()" id="newUser" name="newUser" value="Create a new account"/>
			</div>

			<div id="verifyEmailModalContent" class="logginModal-footer hide">
				<p style="padding-left:50px; color:red;">A verification email has been sent to <strong> <span id="userEmail"></span> </strong>. Please verify your email before creating your Travel Map.</p>
			</div>

		</div>
	</div>


	<div class="title">
		<!-- <p id="ota" style="text-decoration: none;"> <span style="color:white">Office</span> To <span style="color:#A30000">Adventure</span></p> -->
		<img src="/img/ota_plane_right.png" alt=""></img>
		<!-- <img src="/img/ota_final.png" alt=""> -->
		<p>Office To <h2>Adventure</h2></p>
		<!-- <h1>Travel Map Creator</h1> -->
		<h4>Please Select The State You Wish To Use</h4>
		<a id="userDisplay" href="profile.html" class="loggedInUser"></a>
	</div>

	<div class="instructions">
		<h3>State:  <span id="state-name" class="hover-state"> &nbsp;</span> </h3>
		<a id="showEditedStates" href="#" onclick="showEditedStates()" title="showEditedStates">Show State Images</a>
		<a id="showEditedStatesG" href="#" onclick="showEditedStatesG()" title="showEditedStatesG">Green State Images</a>
		<!-- <p>
			<h3>Legend:</h3>
			<ol>
				<li>If a state is colored GREEN then that state has previously been edited.</li>
			</ol>
		</p> -->
	</div>


	<div class="hover-display">
		<!-- <h3>State:  <span id="state-name" class="hover-state"> &nbsp;</span> <br> Id: <span id="id" class="hover-state"> &nbsp; </span> </h3> -->
		<!-- <h3>State:  <span id="state-name" class="hover-state"> &nbsp;</span> </h3> -->
		<p hidden id="id"></p>
	</div>

	<div class="map_container">
		<div id="map" class="map" title="If you have edited a state it will be colored green"></div>
	</div>

	<div class="map-footer">
		<p></p>
	</div>

	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
	<script>
		window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>')
	</script>
	<script src="js/vendor/jquery.jpanelmenu.min.js"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/vendor/fastclick.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/raphael.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
	<script src="js/usa_map.js"></script>
	<script src="js/user_loggin.js"></script>

	<script type="text/javascript">
		var modal = document.getElementById("loginModal");
		var span = document.getElementsByClassName("close")[0];

		var logginModal = function() {
			modal.style.display = "block"
		};

		span.onclick = function() {
			modal.style.display = "none";
			logInReload();
		}

		window.onclick = function() {
			if (event.target == modal) {
				modal.style.display = "none";
				logInReload();
			}
		}

		function showEditedStatesG() {

			for (var i = 0, b = 0; i < states.length; i++) {

				if (states[i].data('id') == statesEdited[b]) {

					states[i].node.style.fill = "#4BB543";

					console.log("SRC: " + states[i].node.style.src);
					console.log("backgroundImage: " + states[i].node.style.backgroundImage);

					if (statesEdited[b + 1] != undefined) {
						b++;
						i = 0;
					}
				}
			}
		}

		function showEditedStates() {
		  var CurrentUser = firebase.auth().currentUser;

		  // for (var i = 0, b = 0; i < states.length - 1; i++) {
			for (var i = 0, b = 0; i < states.length; i++) {
				console.log(states[i].data('id') + " and " + statesEdited[b]);

		    if (states[i].data('id') == statesEdited[b]) {
					console.log(states[i].data('id') + " and " + statesEdited[b] + " matched");

		      firebase.storage().ref(CurrentUser.uid + "/" + statesEdited[b] + "/").child('cropped_state_image.png').getDownloadURL().then(function(url) {

		          if (url != null) {

								// var imageTag = document.createElement("img");
								// imageTag.src = url;
								// document.getElementById("map").appendChild(imageTag);

								//states[0].node.style.fill = "url(" + url + ")";

								states[0].data('xlink:href') = url;



								// texas = document.getElementById("TX");
								// texas.setAttributeNS('http://www.w3.org/1999/xlink','href', 'https://firebasestorage.googleapis.com/v0/b/travel-map-dev.appspot.com/o/aFCFWLccMqVdwYHnp0NqoF2ZU4x2%2FAK%2Fcropped_state_image.png?alt=media&token=89158472-26de-402e-a7cc-06cadefbe92b');

								//document.querySelector('#TX').src = url;
								//states[i].href.baseval = url;

								// states[0].data('xlink:href') = url;
								//states[0].attrs.path.data("xlink:href") = url;

								//in the svg file - in the path for alaska - if we add xlink:href = the path in the url variable then we can see the image on the map

							  //states[0].node.style.fill = "url(" + url + ")"; // This changes the image on the map but its like the state just disappears
								//https://firebasestorage.googleapis.com/v0/b/travel-map-dev.appspot.com/o/sj5MCetdkxPkcBuRx7sOyNuMWes2%2FAK%2Fcropped_state_image.png?alt=media&token=a1933bf7-4d52-4529-b84f-3ea18f19901a

								//  states[0].node.style.fill = "green";

		            console.log(states[i].data('id') + " and " + statesEdited[b]);
		            console.log("State cropped image was sent to the map");

		            if (statesEdited[b + 1] != undefined) {
		              b++;
		              i = 0;
		            };

		          } else {

		            states[i].node.style.fill = "#4BB543";

		            if (statesEdited[b + 1] != undefined) {
		              b++;
		              i = 0;
		            };

		          };
		        }, function(error) {
		          console.log("something bad happened");
		          console.log(error);
		      });
		      }
		    }
		  }


	</script>
</body>

</html>
